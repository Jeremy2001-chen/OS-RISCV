# 异步IO

## 基本情况

在我们的内核上我们支持了异步 IO，由第二个核心实现控制台的输入。

## 具体实现

采用下面的结构体实现 IO 串口输入输出的控制：

```c
struct AsynInput{
    u8 buffer[IO_BUFFER]; // 缓冲区
    struct Spinlock lock; // 锁
    u64 head, tail; // 开始位置和终止位置
};
```

第二个核心将持续轮询 UART 串口，只要缓冲区未满就将读取到的串口数据写到缓冲区中，修改 `tail` 位置。

当第一个核心希望从串口读数据时，将修改 `head` 位置，并返回 `head` 位置的字符。

通过这层异步 IO 的抽象，我们更加容易完成如 ppoll 和 pselect 对于文件描述符是否可以工作的询问请求。
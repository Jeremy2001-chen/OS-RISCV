# FAT 系统调用

## SYS_getcwd 17

获取当前工作目录。

从当前的工作目录开始，递归掉 `dirent->parent` 得到。

## SYS_dup 23

复制文件描述符。

核心是让该文件的引用计数加一。

## SYS_dup3 24

复制文件描述符，并指定了新的文件描述符；

除 sys_dup，还要将文件描述符设给当前进程。

## SYS_chdir 49

切换工作目录。

调用 `ename` 将当前目录切换到得到指定路径的 `dirent`。

## SYS_openat 56

打开或创建一个文件。

调用 `create` 或 `ename` 找到目标文件。然后设置该进程的文件描述符。

## SYS_close 57

关闭一个文件描述符。

将进程控制块中的文件描述符置 0。


## SYS_getdents64 61

获取目录的条目。

不断调用 `enext` 函数，将一个目录下的全部文件信息读出。

## SYS_read 63

从一个文件描述符中读取。

调用 `file_read` 函数即可。

## SYS_write 64

从一个文件描述符中写入。

调用 `file_write` 函数即可。

## SYS_linkat 37

创建文件的链接。

新建一个文件，类型为链接，内容是链接的绝对路径。在 `lookup_path` 的时候，如果是链接文件，则跳转该文件记录的真实文件。

## SYS_unlinkat 35

移除指定文件的链接(可用于删除文件)

调用 `eremove` 删除该文件。

## SYS_mkdirat 34

创建目录。

调用 `create` 即可。

## SYS_umount2 39

功能：卸载文件系统；

通过 `ename` 找到 umount 的目录。删去该目录挂载的文件系统。

## SYS_mount 40

挂载文件系统。

在设置挂载的镜像时，如果是普通文件则直接设置即可；如果是有其他内容的目录，则镜像设为该目录挂载的镜像。同时，被挂载的文件系统的 `read` 设置为 `mountBlockRead`。通过该函数读一个磁盘块，如果文件系统镜像为设备，则调用设备的读函数；如果为文件，则调用 `eread` 在该文件所在的文件系统中读该文件。

在初始化时，需要将 SD 卡挂载到 `/dev/sda1` 下。

## SYS_fstat 80

获取文件状态

通过 `filestat` 函数直接获取。